# Computer Vision Test

## Task 1: Read in the attached image file: three_ships_horizon.JPG

Using `cv2.imread` to read the provided image: three_ships_horizon.JPG

## Task 2: Detect the horizon in the image

- Using Canny method to detect the edges of the image
- Using Hough algorithm to detect the straight line
- However Hough line does not perform very well and cannot provide all the line of horizon so:
    - Instead of create line, I create several data points representing horizon line generated by Hough
    - Filtering the noises and redundant data points by using IQR method if y-axis of those significantly deviate compared to others
    - Using Linear Regression from those filtered data points to create a best suit line representing the horizon

![new](https://github.com/user-attachments/assets/f0970d0c-3ad8-4558-bc27-95ceae42a836)

## Task 3: Rotate the image to adjust the horizon to be level
Having the horizon line detected:
- Using start point (x1, y1) and end point (x2, y2) to calculate the angle with the horizontal level of the image to rotate

![rotated_image](https://github.com/user-attachments/assets/831ce688-592d-447b-85e8-18fe598458e8)

## Task 4: Crop the image down to remove blank pixels created by rotation
Crop the image so that it will remove all blank pixels by using:
- Find a threshold then using `cv2.findNonZero` and `cv2.boundingRect` to find the new parameters (x,y,w,h) for the image

## Task 5 & 6: Apply an edge detection algorithm to detect the three ship and Place bounding boxes around these ships then save as a tiff file
For this object detection, I am using:
- Richer Convolutional Features for Edge Detection -> Using this method, I can find the edges clearer and won't contain lots of noises like Canny, HED ...

![image](https://github.com/user-attachments/assets/01165288-7730-4afb-a1d2-1669e4a5df05)

- After achieve the black and white image with just edges, we can see the ship clearer. Then for filtering the horizon line just in case it will affect the ship detection, we will erase it by drawing the white line on it like this:

![image_with_white_line1](https://github.com/user-attachments/assets/c6252fcc-1c35-4e45-8ad6-df7d26910d7d)

- Then using `cv2.erode` method supported by opencv to reduce noises and enhance the ships like this: 

![final](https://github.com/user-attachments/assets/1542bc5c-7181-427a-8ae5-43811d5cef39)

- After that using `cv2.getStructuringElement` and `cv2.morphologyEx` to improve the thickness edge of the ship and also re-connect the boundary line of the ships:

![final_dilate](https://github.com/user-attachments/assets/59f0b618-1f9f-4ec8-86d1-736fc8f04540)

- Then using the `cv2.connectedComponentsWithStats` to draw the bounding box all of the high density white pixel in the image. At first, it will detect so many noises (wave in the sea) as our object (ships):

![final_bbox_0](https://github.com/user-attachments/assets/5ff60b94-afaf-43fe-9ea6-77a4509b190b)

- Filtering all the redundant object my limiting the dimension of the bounding boxes (if it is too small or too big, it will be noises). 
- I also do 1 more method to filter the noise by expanding the bounding box to some certain ratio, If amount of white pixels in that box does not change that means it is our object (Why is that because the wave in the sea tend to have a trend to be close to each other and very crowed).

After filtering the bounding boxes, I have the correct bounding boxes for the correct ships:

![final_bbox](https://github.com/user-attachments/assets/c8d306de-f89b-40e0-ac4a-cca87a06dbfb)

Then draw it back to our first image:

![output_image](https://github.com/user-attachments/assets/eb871a5b-8f2e-43f8-b58b-0c65b467ad1f)

